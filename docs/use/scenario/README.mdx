import BelowDocument from "/src/components/BelowDocument";

# シナリオ

シナリオの概念とその概要について説明しています。

---

## 概要

シナリオは、プラグインのふるまいを定義するファイルと、それを実行するエンジンです。
開発者がプラグインの代表的な I/O (e.g. メッセージの送信、プレイヤゲームモードの変更...) を予めシナリオとして定義しておき、Scenamatica がそれをステップ実行します。
シナリオの実行結果はそのままテスト結果として出力されるため、プラグインの自動テストが実現されます。

シナリオはセッションと呼ばれる集合の単位で実行されます。  
セッションに関しては[こちら](#scenario-session)を参照してください。

## シナリオの具体的な内容及び構造 {#scenario-elements}

<BelowDocument docId="use/scenario/elements"
               label="シナリオの具体的な内容及び構造"
/>

## シナリオの記述作業を開発フローに取り込む {#integrating-scenamatica}

シナリオ機能を利用するには、プラグイン機能・テストごとに [シナリオファイル](#scenario-file) を作成する作業が必要です。
なぜなら、Scenamatica は何をしたらあなたのプラグインの機能が実行されるかや、その結果がどうなるかを知らないからです。
そのため、開発者がプラグインの機能を Scenamatica に教える必要があります。

シナリオファイルの記述は JUnit のテストコードの記述と同じように、開発フローに取り込めます。
例えば、新規機能を追加する際には、その機能を実装する前にシナリオファイルを作成し、それにそって実装を進めるとよいでしょう。

## シナリオファイルについて {#scenario-file}

Scenamatica のシナリオは シナリオファイルと呼ばれる YAML ファイルで記述します。  
シナリオファイルはプラグインの .jar ファイルの任意の場所に配置します。

<BelowDocument docId="use/scenario/file-syntax"
               label="シナリオファイル"
               message="シナリオファイルの構文については、以下のページを参照してください。" />

## シナリオセッションについて {#scenario-session}

シナリオセッションは、複数のシナリオをまとめて実行するための機能です。
１つのセッションは複数のシナリオを持ちます。
セッションに登録される各シナリオは順番付けられ、その順番に従って実行されます。  
セッションは実行時に自動で構成されるため、シナリオファイル等にセッションを**定義する必要はありません**。

:::tip

同じ発火条件を持つシナリオが発火した場合、同じセッションに登録されます。  
例えば、 シナリオの読み込み後 (`ON_LOAD`) トリガを持つシナリオが .jar ファイルに複数存在する場合、同じセッションで実行されます。

:::

:::info

シナリオを実行するには、必ずセッションが必要です。  
セッションが存在しない場合、シナリオキューマネージャは新規セッションを作成します。

:::


### シナリオの実行順序の制御 {#scenario-ordering}

シナリオの実行順序は、シナリオファイルの `order` プロパティによって制御できます。  
デフォルトは `Integer.MAX_VALUE`\(`2147483647`) です。これを設定しない場合は自動的に名前順でソートされ、セッションの末尾に追加されます。

:::warning ただし、実行順序の制御は**同一セッション内でのみ有効**です。

例えば、以下のようなシナリオとセッション（順不同）を考えます。

+ シナリオA - `order: 1`
+ シナリオB - `order: 2`
+ シナリオC - `order: 3`
+ シナリオD - \(未設定)

+ セッション\[0]
  + シナリオD
  + シナリオA
  + シナリオC
+ セッション\[1]
  + シナリオD
  + シナリオB

このとき, シナリオの実行順は `D -> A -> C -> D -> B` となります。
また、シナリオの実行順序はセッションごとに独立しているため、セッション\[0] の中身 => セッション\[1] の中身というように実行されます。

:::

## Scenamaticaの実行フロー {#scenario-flow}

![Flow#550x](images/scenamatica-flow.svg)

### シナリオの実行フロー

![Scenario#550x](images/scenario.svg)
