import BelowDocument from "/src/components/BelowDocument";

# シナリオ

シナリオの概念とその概要について説明しています。

---

## 概要 {#overview}

シナリオは、プラグインの機能とその発火方法をフローで定義した脚本のようなものです。
Scenqamatica はシナリオを読み込み、その内容に沿ってプラグインの機能を発火し、およびその結果を検証します。  
シナリオはプラグインの機能ごとに複数定義でき、複数のシナリオをまとめて管理できます。

## シナリオの具体的な構成要素 {#scenario-elements}

<BelowDocument docId="use/scenario/elements"
               label="シナリオを構成する要素"
/>

## シナリオファイルについて {#scenario-file}

Scenamatica のシナリオは シナリオファイルと呼ばれる YAML ファイルで記述します。  
シナリオファイルはプラグインの .jar ファイルの任意の場所に配置します。

<BelowDocument docId="use/scenario/file-syntax"
               label="シナリオファイル"
               message="シナリオファイルの構文については、以下のページを参照してください。" />

## シナリオの記述作業を開発フローに取り込む {#integrating-scenamatica}

シナリオ機能を利用するには、プラグインの機能やテストごとに [シナリオファイル](#scenario-file) を記述する作業が必要です。  
なぜなら、Scenamatica はあなたが作成した機能の発火条件や、それにどのような結果が期待されているかを知りせん。
そのため、プラグインの開発者が正しい（期待される）動作を Scenamatica に教える必要があります。

驚くことに、シナリオファイルの記述は JUnit のテストコードの記述と同じくらいかんたんです。  
新規機能を追加する際には、その機能を実装する前にシナリオファイルを作成し、それに沿って実装を進めるとよいでしょう。

プラグインにおけるテスト駆動開発の始まりです。

## シナリオセッションとは {#scenario-session}

シナリオセッションは、複数のシナリオ実行をまとめて管理するための機能です。
１つのセッションは複数のシナリオを持ち、それらはセッション内で順番付けされて実行されます。  
シナリオの実行結果はセッションごとに集計され出力されます。

シナリオセッションは実行時に自動で構成されるため、開発者が意識する必要はありません。

:::tip

シナリオが同じトリガで、かつ同タイミングで発火した場合、同じセッションに登録されます。  
例えば、 シナリオの読み込み後に実行するトリガ (`ON_LOAD`) を持つシナリオが .jar ファイルに複数存在する場合、同じセッションで実行されます。

:::


## シナリオの実行の状態 {#scenario-status}

Scenamatica のシナリオの実行状況は以下の状態に分類されます。  
シナリオの実行が異常終了した場合、以下の状態一覧を参考にするとエラー原因の特定に役立つでしょう。

+ `STAND_BY`  
  シナリオがコンパイルされ、実行を待機している状態です。
+ `CONTEXT_PREPARING`  
  シナリオの実行に必要なコンテキストを準備している状態です。
+ `STARTING`  
  シナリオエンジンを初期化し、起動を待機している状態です。
+ `RUNNING_BEFORE`（オプション）  
  [メインシナリオの実行前に実行されるシナリオ](elements/#scenario)を実行している状態です。  
  トリガによっては実行されることがあります。
+ `RUNNING_MAIN`  
  シナリオの実行を行っている状態です。
+ `RUNNING_AFTER`（オプション）
  シナリオの実行後に実行されるシナリオを実行している状態です。  
  トリガによっては実行されることがあります。
+ `CLEANING_UP`  
  シナリオの実行後の後処理を行っている状態です。
+ `FINISHED`  
  シナリオの実行が終了した状態です。


## Scenamaticaの実行フロー {#scenario-flow}

![Flow#550x](images/scenamatica-flow.svg)

### シナリオの実行フロー

![Scenario#550x](images/scenario.svg)
