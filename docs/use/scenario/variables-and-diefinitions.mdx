# 変数と定義

このページでは、シナリオファイルでの変数と定義機能について説明します。

---

## 定義と機能の概要 {#definition}

定義機能は、シナリオファイルで変数を定義し、同じファイルの任意の場所から参照できるようにする機能です。

主に、アクタのインベントリや検証用のメッセージなど、同じ値を複数回使用する場合に使用します。  
これにより、シナリオファイルの冗長な記述を減らし、可読性と保守性を向上させます。

定義・参照には以下のの２つの種類があります。
1. オブジェクトの定義
  オブジェクトとは、アクタのインベントリの設定など、 YAML の `キー:値` で表現されるものです。
  参照用のプロパティを使用したいところで記述することで、オブジェクトの値を参照できます。
2. 埋め込み文字列の定義
  シナリオファイル内の任意の文字列の一部または全部を、定義を使用して置換します。
  :::caution
  文字列の埋め込み機能は、 YAML のキーでは使用できません。
  :::

### 定義の作成 {#create-definition}
  
定義は、シナリオファイルの頂点に `definitions` という名前のオブジェクトを作成し、その中に定義を記述します。  
キーには割り当てる任意の名前を記述し、値には定義したい任意の型の値を記述します。

以下は、定義の例です。

```yaml
scenamatica: 1.0.0

# （中略）

definitions:
  # オブジェクトの定義
  item:
    type: DIAMOND_HOE
    name: "ダイヤのクワ"
    lores:
      - "めちゃつよダイヤのクワ"

  # 埋め込み文字列の定義
  death_message: "死んでしまった！"

```

### 定義されたオブジェクトを参照する {#reference-object-definition}

定義されたオブジェクトは、シナリオファイル内の任意の場所で参照できます。  
`$ref` というキーを任意の場所で定義すると、 `$ref` のある階層に定義が展開されます。

参照元に同じキーのプロパティがある場合、参照元の値がそのまま使用されます。  
また、 参照時に `$ref` プロパティは削除されます。

以下は、定義されたオブジェクトを参照する例です。定義は [定義の作成](#create-definition) で作成したものを使用しています。

```yaml
# （中略）

context:
  actors:
    - name: Hoge
      # インベントリの 0, 1, 2 番目のスロットに定義された item を設定
      main:
        0:
          $ref: item
        1:
          $ref: item
        2:
          $ref: item

```

### 埋め込み文字列を参照する {#reference-embedded-string-definition}

埋め込み文字列は、シナリオファイル内の任意の文字列内で使用できます。
任意の文字列内で `${` と `}` で定義の名前を囲んで使用します。

`{` と `}` をエスケープする場合は、 `${{}` や `${}}` のように記述します。
（`{` と `}` という名前の定義が暗黙的に作成されており、参照の形でアクセスします。）

以下は、埋め込み文字列を参照する例です。定義は [定義の作成](#create-definition) で作成したものを使用しています。

```yaml

# （中略）

actions:
  - type: expect
    action: "message"
    with:
      message: "死亡メッセージ：${death_message}"
      recipient: "Hoge"

```
