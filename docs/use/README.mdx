import BelowDocument from "/src/components/BelowDocument";
import Requirements from "/src/components/Requirements";

# Scenamatica を使う

Scenamatica を使う方法について説明しています。

---

## このページの前提条件 {#requisites}

<Requirements requirements={[
  {
    name: "Scenamatica",
    version: "0.1.0 以上",
    link: "/docs/getting-started/installation"
  },
  {
    name: "Java",
    version: "8 以上",
    link: "https://www.java.com/ja/download/",
    description: "Java 11 以上が推奨されていますが、最低要件は Java 8 です。"
  },
  {
    name: "PaperMC",
    version: "1.16.5",
    link: "https://papermc.io/downloads",
    description: "現時点では v1.16.5 にのみ対応しています。"
  }
]} />

:::info
Scenamatica をまだインストールしていない場合は、[こちら](/docs/getting-started/installation)のドキュメントを参照してインストールしてください。
:::

:::caution
現時点のベータ版 Scenamatica は、 PaperMC の 1.16.5 にのみ対応しています。
:::
  
## はじめに {#introduction}

Scenamatica は、 PaperMC プラグインの開発でリグレッションを防ぎ、開発体験を向上させるために設計されました。
そのため、毎回のリリース前に Scenamatica を使用して、プラグインの動作を確認することをお勧めします。

また、 Scenamatica は Junit 等のユニットテストフレームワークと一緒に使用することを想定しています。

## Scenamatica のシナリオ {#writing-scenario-file}

Scenamatica は、プラグインの動作のフローを記述した [シナリオファイル](/docs/scenario/#scenario-file) をしてプラグインの動作をテストします。
このファイルは、プラグイン開発者が記述する必要があります。

<BelowDocument docId={"use/scenario/README"}
               label={"シナリオ"} />

## プラグインのテスト

プラグインのテストは、 Scenamatica のメインの機能の一つです。  
[シナリオ](scenario)の実行機能を利用して、プラグインの正常性をテストします。

## テストの実行 {#test-run}

プラグインのテストは、シナリオが実行されたときに自動的に開始されます。  
テスト（シナリオ）を手動で実行するには、[<kbd>/scenamatica scenario start</kbd>](/docs/use/commands/scenario/#start)コマンドを実行します。

:::info

Scenamatica における シナリオ と テストは密接に関連しています。

:::

### テストの状態 {#test-status-status}

Scenamatica のテストは、以下の状態を持ちます。

+ `STAND_BY`  
シナリオがコンパイルされ、実行を待機している状態です。
+ `CONTEXT_PREPARING`  
シナリオの実行に必要なコンテキストを準備している状態です。
+ `STARTING`  
シナリオエンジンを初期化し起動を待機している状態です。
+ `RUNNING_BEFORE`（オプション）  
シナリオの実行前に実行されるシナリオを実行している状態です。  
トリガによっては実行されることがあります。
+ `RUNNING_MAIN`  
シナリオの実行を行っている状態です。
+ `RUNNING_AFTER`（オプション）
シナリオの実行後に実行されるシナリオを実行している状態です。  
トリガによっては実行されることがあります。
+ `CLEANING_UP`  
シナリオの実行後の後処理を行っている状態です。
+ `FINISHED`  
シナリオの実行が終了した状態です。


### テストの結果 {#test-status-result}

Scenamatica のテストは、以下の結果を持ちます。

+ `PASSED`  
全てのテスト項目を正常に通過し、シナリオが正常に終了したことを示します。
+ `CONTEXT_PREPARATION_FAILED`  
シナリオの実行に必要なコンテキストの準備に失敗したことを示します。
+ `ACTION_EXECUTION_FAILED`  
アクションの実行に失敗したことを示します。
+ `ACTION_EXPECTATION_JUMPED`

実行を期待するアクションよりも先に他のアクションが（プラグインによって）実行されたことを示します。
+ `SCENARIO_TIMED_OUT`  
実行を期待するアクションやシナリオが（所定の時間内に）実行されなかったことを示します。
+ `ILLEGAL_CONDITION`  
コンディションチェックに失敗したことを示します。

+ `INTERNAL_ERROR`  
内部エラーが発生したことを示します。
+ `CANCELLED`  
シナリオの実行がキャンセルされたことを示します。
+ `SKIPPED`  
シナリオの実行が何らかの要因によってスキップされたことを示します。
