# 最初のシナリオを書いてみる

あなたの最初のシナリオを書いてみましょう。

---

## 注意事項 {#writing-scenario}

この項目では、**基本的な**シナリオファイルを書く方法について説明します。  
ここにない高度な機能や、その他の完全な構文については[こちら](/docs/use/scenario/file-syntax)を参照してください。

## ステップ１. ファイルを作成する

まずは、シナリオファイルを作成します。ファイルの拡張子は `.yml` です。  
場所に関しては、プラグインの最終的な `.jar` ファイルに配置されるのであればどこでも構いません。

この例では、 `test-hoge-success.yml` というファイル名で作成します。

## ステップ２. Scenamatica バージョンを記述する

シナリオファイルの先頭には、対応している Scenamatica のバージョン(`scenamatica`) を記述します。  
これは、プラグインが対応している Scenamatica がサーバのものよりも古い場合に存在しない機能を参照しないようにするためです。

プラグインのデバッグ用のサーバに配置されている Scenamatica と同じバージョンを記述してください。

```yml {1}
scenamatica: "0.0.1"
```

## ステップ３. 名前ち説明を記述する

シナリオファイルの次に、シナリオの名前と説明を記述します。

名前(`name`) は、シナリオの識別子として使用されます。プラグインのなかで一意な命名をしてください。  
説明(`description`) は、人間が読みやすいような説明文を記述します。

```yaml {2-3}
scenamatica: "0.0.1"
name: "test-hoge-success"
description: "hoge 機能の正常系テスト"
```

## ステップ４. コンテキストを記述する

[コンテキスト](/docs/use/scenario/elements#context)は、シナリオの実行に必要な環境を記述します。  
今回のテストでは、`/hoge` コマンドの実行者としてプレイヤ `Actor1` がいることを想定しているので、以下のように記述します。  
また、ネザーで実行するようにしてみましょう。

```yaml {5-}
scenamatica: "0.0.1"
name: "test-hoge-success"
description: "hoge 機能の正常系テスト"

context:
  actors:
  - name: Actor1
  stage:
    env: NETHER
```

## ステップ５. トリガを記述する

シナリオが実行されるためには、発火のための[トリガ](/docs/use/scenario/elements#trigger)が必要です。  
トリガは、 `triggers` というキーでオブジェクトのリストで記述します。

今回は手動実行のみを想定しているので、 手動実行(`manual_dispatch`) というトリガを記述します。

```yaml {11-12}
scenamatica: "0.0.1"
name: "test-hoge-success"
description: "hoge 機能の正常系テスト"

context:
  actors:
  - name: Actor1
  stage:
    env: NETHER

triggers:
- type: manual_dispatch
```

:::tip

今回は上記のトリガのみ実装しましたが、ほかにもいろいろなトリガがあります。

詳しくは[こちら](/docs/use/scenario/elements#trigger)を参照してください。

:::

## ステップ６. シナリオを記述する

プラグインの入力と出力をおおまかに抽出し、シナリオ化して記述します。

例として、今回のプラグインの機能を箇条書きにすると、以下のようになります。

+ コマンド `/hoge` でルーチンが開始する。
+ `fuga` というメッセージが表示される。
+ 実行者 が死ぬ。

これらをシナリオ化すると、以下のようになります。

```yaml {14-25}
scenamatica: "0.0.1"
name: "test-hoge-success"
description: "hoge 機能の正常系テスト"

context:
  actors:
  - name: Actor1
  stage:
    env: NETHER

triggers:
- type: manual_dispatch

scenario:
  # Actor1 が /hoge を実行する。
- type: command_dispatch
  command: "/hoge"
  sender: Actor1
  # fuga というメッセージが（Actor1 に）表示される。
- type: message
  content: "fuga"
  recipient: Actor1
  # Actor1 が死ぬ。
- type: player_death
  target: Actor1
```

## ステップ７. シナリオを実行する

シナリオが記述できたら、実行してみましょう。

今回の例では、手動実行のトリガを使用するので、 <kbd>/scenamatica run <プラグイン名> test-hoge-success</kbd> を実行します。

:::caution

シナリオを手動実行に対応させるためには、 `triggers` に `manual_dispatch` が含まれている必要があります。

:::

## ステップ８. 糸冬 了
  
以上でチュートリアルは終了です。お疲れ様でした。

シナリオファイルの完全な構文については[こちら](/docs/use/scenario/file-syntax)を参照してください。  
CI/CD で Scenamatica を使用する方法については[こちら](/docs/use/integration/ci-cd)を参照してください。
